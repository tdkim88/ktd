<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>

<body>
    <form id="api_form">
        <input type="text" id="api_text_year" value="2015" />
        <input type="button" id="api_btn" value="Show" onclick="getDivision24();" />
    </form>

    <script>
        //alert(("" + 234).trim());

        function mytrim(mystr) {
            if (mystr == undefined) {
                return "";
            }

            try {
                var tmp_str = "" + mystr;
                return tmp_str.trim();

            } catch (e) {
                return "";
            }
        }

        function getDivision24() {

        

            try {
                //http://apis.data.go.kr/B090041/openapi/service/SpcdeInfoService/get24DivisionsInfo?solYear=2015&solMonth=05&ServiceKey=9uOfsoDPvjkJiIw/W/ulLkEd7f7eLzc+i2nyXfFkR+WMKPRkwFzV81ZMJGTEFO1M0tVL0S0dKasuCLJ+1g2wPw==

                var my_year = eval(document.getElementById("api_text_year").value); // '2019';

                //실패 코드
                //실패 이유:  Internet Explorer 9 이상에 최적화되었고 기타 브라우저는 사용이 불가능
                //다음 요청은 <Internet Explorer 9>에서 작동함, <Chrom>에서는 작동 안함.
                var xhr = new XMLHttpRequest();
                var url = 'http://openapi.kasi.re.kr/openapi/service/SpcdeInfoService/get24DivisionsInfo'; /*URL*/
                var queryParams = '?' + encodeURIComponent('ServiceKey') + '=' + encodeURIComponent('9uOfsoDPvjkJiIw/W/ulLkEd7f7eLzc+i2nyXfFkR+WMKPRkwFzV81ZMJGTEFO1M0tVL0S0dKasuCLJ+1g2wPw=='); /*Service Key*/
                queryParams += '&' + encodeURIComponent('solYear') + '=' + encodeURIComponent(my_year); /**/
                //queryParams += '&' + encodeURIComponent('solMonth') + '=' + encodeURIComponent('09'); /**/
                queryParams += '&' + encodeURIComponent('kst') + '=' + encodeURIComponent('0120'); /**/
                queryParams += '&' + encodeURIComponent('sunLongitude') + '=' + encodeURIComponent('285'); /**/
                queryParams += '&' + encodeURIComponent('numOfRows') + '=' + encodeURIComponent('30'); /**/
                queryParams += '&' + encodeURIComponent('pageNo') + '=' + encodeURIComponent('1'); /**/
                queryParams += '&' + encodeURIComponent('totalCount') + '=' + encodeURIComponent('210114'); /**/
                //queryParams += '&' + encodeURIComponent('type') + '=' + encodeURIComponent('jsonp'); /*queryParams += '&' + encodeURIComponent('_type') + '=' + encodeURIComponent('json'); */
                
                //기본: XML 형식의 문자열
                //요청: JSON 형식의 문자열 (2020.07.10. 10:46) 
                queryParams += '&' + encodeURIComponent('_type') + '=' + encodeURIComponent('json'); 
                //xhr.open('GET', url + queryParams);
                //xhr.send('');

                //https://stackoverflow.com/questions/12359047/using-json-to-parse-xmlhttp-responsetext-for-populating-textboxes
                xhr.open('GET', url + queryParams, true); //2020.07.22
                



                xhr.onreadystatechange = function () {
                    if (this.readyState == 4) {
                        console.log('\n Status_1: ' + this.status);
                        console.log('\n nHeaders_1: ' + JSON.stringify(this.getAllResponseHeaders()));
                        console.log('\n nBody_1: ' + this.responseText);
                        //alert('\n\nStatus: ' + this.status + '\n\nnHeaders: ' + JSON.stringify(this.getAllResponseHeaders()) + '\n\nnBody: ' + this.responseText);

                        //mystring = this.responseText;
                        mystring = this.responseText;

                        console.log("this.responseText: \n\n" + mystring);
                        

                        


                        // '{"response":{"header":{"resultCode":"00","resultMsg":"NORMAL SERVICE."},"body":{"items":{"item":[{"dateKind":"03","dateName":"소한","isHoliday":"N","kst":"0630      ","locdate":20200106,"seq":1,"sunLongitude":285},{"dateKind":"03","dateName":"대한","isHoliday":"N","kst":"2355      ","locdate":20200120,"seq":1,"sunLongitude":300},{"dateKind":"03","dateName":"입춘","isHoliday":"N","kst":"1803      ","locdate":20200204,"seq":1,"sunLongitude":315},{"dateKind":"03","dateName":"우수","isHoliday":"N","kst":"1357      ","locdate":20200219,"seq":1,"sunLongitude":330},{"dateKind":"03","dateName":"경칩","isHoliday":"N","kst":"1157      ","locdate":20200305,"seq":1,"sunLongitude":345},{"dateKind":"03","dateName":"춘분","isHoliday":"N","locdate":20200320,"seq":1},{"dateKind":"03","dateName":"청명","isHoliday":"N","kst":"1638      ","locdate":20200404,"seq":1,"sunLongitude":15},{"dateKind":"03","dateName":"곡우","isHoliday":"N","kst":"2345      ","locdate":20200419,"seq":2,"sunLongitude":30},{"dateKind":"03","dateName":"소만","isHoliday":"N","kst":"2249      ","locdate":20200520,"seq":1,"sunLongitude":60},{"dateKind":"03","dateName":"망종","isHoliday":"N","kst":"1358      ","locdate":20200605,"seq":2,"sunLongitude":75},{"dateKind":"03","dateName":"하지","isHoliday":"N","kst":"0644      ","locdate":20200621,"seq":1,"sunLongitude":90},{"dateKind":"03","dateName":"소서","isHoliday":"N","kst":"0014      ","locdate":20200707,"seq":1,"sunLongitude":105},{"dateKind":"03","dateName":"대서","isHoliday":"N","kst":"1737      ","locdate":20200722,"seq":1,"sunLongitude":120},{"dateKind":"03","dateName":"입추","isHoliday":"N","kst":"1006      ","locdate":20200807,"seq":1,"sunLongitude":135},{"dateKind":"03","dateName":"처서","isHoliday":"N","kst":"0045      ","locdate":20200823,"seq":1,"sunLongitude":150},{"dateKind":"03","dateName":"백로","isHoliday":"N","kst":"1308      ","locdate":20200907,"seq":1,"sunLongitude":165},{"dateKind":"03","dateName":"추분","isHoliday":"N","kst":"2231      ","locdate":20200922,"seq":1,"sunLongitude":180},{"dateKind":"03","dateName":"한로","isHoliday":"N","kst":"0455      ","locdate":20201008,"seq":2,"sunLongitude":195},{"dateKind":"03","dateName":"상강","isHoliday":"N","kst":"0800      ","locdate":20201023,"seq":1,"sunLongitude":210},{"dateKind":"03","dateName":"입동","isHoliday":"N","kst":"0814      ","locdate":20201107,"seq":1,"sunLongitude":225},{"dateKind":"03","dateName":"소설","isHoliday":"N","kst":"0540      ","locdate":20201122,"seq":1,"sunLongitude":240},{"dateKind":"03","dateName":"대설","isHoliday":"N","kst":"0109      ","locdate":20201207,"seq":1,"sunLongitude":255},{"dateKind":"03","dateName":"동지","isHoliday":"N","kst":"1902      ","locdate":20201221,"seq":1,"sunLongitude":270}]},"numOfRows":30,"pageNo":1,"totalCount":23}}}'
                        //위의 값은 json 객체를 문자열 부호로 둘러싸고 있으므로
                        //JSON.parse()를 사용하여 문자열 값을 실제 json 객체로 변환한 후 접근해야 함
                        //string 객체를 json 객체로 변환시켜 줌. 
                        var mydata = JSON.parse(mystring);

                        //alert("length: " + mydata["response"]["body"]["items"]["item"].length);

                        var item_len = mydata["response"]["body"]["items"]["item"].length;
                        console.log("\n" + my_year + "'s data_length: " + item_len + "\n");

                        var my_solar24_info = "{\n";
                        for (var i = 0; i < item_len; i++) {
                            my_locdate = mydata["response"]["body"]["items"]["item"][i]["locdate"];
                            my_dateName = mydata["response"]["body"]["items"]["item"][i]["dateName"];
                            my_kst = mydata["response"]["body"]["items"]["item"][i]["kst"];

                            //str.substring(startIndex, endIndex); 

                            my_yyyymmdd = mytrim(my_locdate);
                            my_hhnn = mytrim(my_kst);

                            my_yyyy = my_yyyymmdd.substring(0, 4);
                            my_mm = my_yyyymmdd.substring(4, 6);
                            my_dd = my_yyyymmdd.substring(6, 8);

                            my_hh = my_hhnn.substring(0, 2);
                            my_nn = my_hhnn.substring(2, 4);


                            //my_solar24_info += "\t'" + mytrim(my_locdate) + mytrim(my_kst) + "':'" + mytrim(my_dateName) + "',\n";
                            my_solar24_info += "\t" + my_yyyy + "\t" + my_mm + "\t" + my_dd + "\t" + my_hh + "\t" + my_nn + "\t:\t" + mytrim(my_dateName) + "',\n";
                        }

                        my_solar24_info += "};";

                        
                        console.log("\n" + my_year + " 년, " + "Division 24 Information: \n" + my_solar24_info);
                        //alert("my_solar24_info: \n\n" + my_solar24_info);

                        //alert("dateName: \n" + mydata["response"]["body"]["items"]["item"][0]["dateName"]);
                        //alert("locdate: \n" + mydata["response"]["body"]["items"]["item"][0]["locdate"]);
                        //alert("kst: \n" + mydata["response"]["body"]["items"]["item"][0]["kst"]);

                        //console.log('dateName_1: ' + mybody.response); //["body"]["items"]["item"][0]["dateName"]);
                        //console.log('locdate_1: ' + mybody["response"]["body"]["items"]["item"][0]["locdate"]);
                    }
                };

                xhr.send(null);
            }
            catch (e) {
                console.log(e);
            }

        
            
            var xhr = new XMLHttpRequest();
            var url = 'http://openapi.kasi.re.kr/openapi/service/SpcdeInfoService/get24DivisionsInfo'; /*URL*/
            var queryParams = '?' + encodeURIComponent('ServiceKey') + '='+'9uOfsoDPvjkJiIw/W/ulLkEd7f7eLzc+i2nyXfFkR+WMKPRkwFzV81ZMJGTEFO1M0tVL0S0dKasuCLJ+1g2wPw=='; /*Service Key*/
            //queryParams += '&' + encodeURIComponent('ServiceKey') + '=' + encodeURIComponent('-'); /**/
            //queryParams += '&' + encodeURIComponent('pageNo') + '=' + encodeURIComponent('1'); /**/
            //queryParams += '&' + encodeURIComponent('numOfRows') + '=' + encodeURIComponent('30'); /**/
            queryParams += '&' + encodeURIComponent('solYear') + '=' + encodeURIComponent('2015'); /**/
            //queryParams += '&' + encodeURIComponent('solMonth') + '=' + encodeURIComponent('02'); /**/
            queryParams += '&' + encodeURIComponent('_type') + '=' + encodeURIComponent('json'); 
            xhr.open('GET', url + queryParams);
            xhr.onreadystatechange = function () {
                if (this.readyState == 4) {
                    console.log('Status: \n'+this.status);
                    console.log();
                    console.log('nHeaders: \n'+JSON.stringify(this.getAllResponseHeaders()));
                    console.log();
                    console.log('nBody: \n'+this.responseText);
                }
            };

            xhr.send('');
        }
    </script>
</body>

</html>